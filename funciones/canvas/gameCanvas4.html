<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<!--[if lte IE 8]><meta http-equiv="X-UA-Compatible" content="chrome=1" /><![endif]-->
<title>My First Canvas Game</title>
<script type="text/javascript" src="../jquery.js"></script>
<script type="application/javascript" src="game.js"></script>

<script type="text/javascript">

window.addEventListener('load',init,false);
var canvas=null,ctx=null;
var lastKey=null;
var PAUSE=true;
var dir=0;
var score=0;
var player=new Rectangle(40,40,20,20);
var food=new Rectangle(80,80,20,50);

function random(max){
 return parseInt(Math.random()*max);
}

function init(){
 canvas=document.getElementById('canvas');
 canvas.style.background='#000';
 ctx=canvas.getContext('2d');
 setInterval(run,500);
}

function run(){
 game();
 paint(ctx);
}

function game(){
 if(!PAUSE){
  // Change Direction
  if(lastKey==38)
   dir=0;
  if(lastKey==39)
   dir=1;
  if(lastKey==40)
   dir=2;
  if(lastKey==37)
   dir=3;

  // Move Rect
  if(dir==0)
   player.y-=10;
  if(dir==1)
   player.x+=10;
  if(dir==2)
   player.y+=10;
  if(dir==3)
   player.x-=10;

  // Out Screen
  if(player.x>canvas.width)
   player.x=0;
  if(player.y>canvas.height)
   player.y=0;
  if(player.x<0)
   player.x=canvas.width;
  if(player.y<0)
   player.y=canvas.height;

  // Food Intersects
  if(player.intersects(food)){
   score++;
   food.x=random(canvas.width/10-1)*10;
   food.y=random(canvas.height/10-1)*10;
  }
 }
 // Pause/Unpause
 if(lastKey==13){
  PAUSE=!PAUSE;
  lastKey=null;
 }
}

function paint(ctx){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle='#0f0';
 ctx.fillRect(player.x,player.y,player.width,player.height);
 ctx.fillStyle='#f00';
 ctx.fillRect(food.x,food.y,food.width,food.height);
 ctx.fillStyle='#fff';
 //ctx.fillText('Last Key: '+lastKey,0,20);
 ctx.fillText('Score: '+score,0,10);
 if(PAUSE)
  ctx.fillText('PAUSE',140,75);
}

document.addEventListener('keydown',function(evt){
 lastKey=evt.keyCode;
},false);

	function Rectangle(x,y,width,height){
	 this.x=(x==null)?0:x;
	 this.y=(y==null)?0:y;
	 this.width=(width==null)?0:width;
	 this.height=(height==null)?this.width:height;
	
		 this.intersects=function(rect){
			  if(rect!=null)
			  {
				   return(	this.x<rect.x+rect.width&&
							this.x+this.width>rect.x&&
							this.y<rect.y+rect.height&&
							this.y+this.height>rect.y
							);
			  console.log(this.x+' '+(rect.x+rect.width));
			  }
		 }
	}

</script> 

</head>

<body>
<h1>lala</h1>

<p><canvas id="canvas" width="300" height="150" style="border:1px solid #000">
Canvas not supported by your browser.
</canvas></p>

</body>
</html>